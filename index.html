<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• v31 - Ultra Balanced</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.294.0",
            "xlsx": "https://cdn.sheetjs.com/xlsx-0.20.1/package/xlsx.mjs"
        }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { 
            font-family: 'Sarabun', sans-serif; 
            margin: 0;
            padding: 0;
        }
        
        .overflow-x-auto::-webkit-scrollbar { height: 12px; }
        .overflow-x-auto::-webkit-scrollbar-track { background: #f1f5f9; }
        .overflow-x-auto::-webkit-scrollbar-thumb { 
            background: #94a3b8; 
            border-radius: 6px; 
            border: 2px solid #f1f5f9; 
        }
        .overflow-x-auto::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        table { 
            border-spacing: 0;
            width: 100%;
        }
        
        th, td {
            white-space: nowrap;
            text-align: center;
            border: 1px solid #e2e8f0;
            height: 30px;
            padding: 0 2px;
            font-size: 13px;
        }

        /* Sticky Columns */
        .sticky-1 { 
            position: sticky; 
            left: 0; 
            width: 30px; 
            min-width: 30px; 
            max-width: 30px; 
            background-color: white; 
            border-right: 1px solid #e2e8f0; 
            z-index: 35; 
        }
        
        .sticky-2 { 
            position: sticky; 
            left: 30px; 
            width: 110px; 
            min-width: 110px; 
            max-width: 110px; 
            background-color: white; 
            border-right: 1px solid #e2e8f0; 
            z-index: 35; 
        }
        
        .sticky-3 { 
            position: sticky; 
            left: 140px; 
            width: 50px; 
            min-width: 50px; 
            max-width: 50px; 
            background-color: white; 
            border-right: 2px solid #cbd5e1; 
            box-shadow: 4px 0 6px -2px rgba(0, 0, 0, 0.1); 
            z-index: 35; 
        }
        
        thead tr th { 
            position: sticky; 
            top: 0; 
            z-index: 40; 
            background-color: #f8fafc; 
        }
        
        thead tr th.sticky-1, 
        thead tr th.sticky-2, 
        thead tr th.sticky-3 { 
            z-index: 50; 
        }

        .cell-hover:hover { 
            filter: brightness(0.95); 
            cursor: pointer; 
            transform: scale(1.05);
            transition: all 0.15s;
        }
        
        .header-hover:hover { 
            background-color: #e2e8f0; 
            cursor: pointer; 
            user-select: none; 
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        /* Loading Spinner */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            font-size: 12px;
            border-radius: 6px;
            white-space: nowrap;
            z-index: 100;
            margin-bottom: 5px;
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            table {
                font-size: 10px;
            }
            
            .sticky-1, .sticky-2, .sticky-3 {
                position: static;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            th, td {
                font-size: 11px;
                padding: 0 1px;
            }
            
            .sticky-2 {
                width: 80px;
                min-width: 80px;
                max-width: 80px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Download, Calculator, UserPlus, Trash2, ChevronLeft, ChevronRight, Zap, Eraser, Settings, Edit2, Save, X, Info, BarChart3 } from 'lucide-react';
        import * as XLSX from 'xlsx';

        const RATES = { shift: 600, ot: 600 };

        const SHIFT_TYPES = {
            '0':      { label: '0',      color: 'bg-white text-gray-300 font-medium' },
            '‡∏ä':      { label: '‡∏ä',      color: 'bg-green-50 text-green-700 font-bold' },
            '‡∏ö':      { label: '‡∏ö',      color: 'bg-yellow-50 text-yellow-700 font-bold' },
            '‡∏î':      { label: '‡∏î',      color: 'bg-purple-50 text-purple-700 font-bold' },
            'Va':     { label: 'Va',     color: 'bg-blue-50 text-blue-700 font-bold text-xs' },
            '‡∏õ‡∏ä':     { label: '‡∏õ‡∏ä',     color: 'bg-orange-50 text-orange-700 font-bold text-xs' },
            '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢': { label: '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢', color: 'bg-red-100 text-red-700 font-bold text-[10px]' },
            '‡∏•‡∏≤‡∏Å‡∏¥‡∏à':  { label: '‡∏•‡∏≤‡∏Å‡∏¥‡∏à',  color: 'bg-indigo-100 text-indigo-700 font-bold text-[10px]' }
        };
        
        const NON_WORKING_CODES = ['Va', '‡∏õ‡∏ä', '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢', '‡∏•‡∏≤‡∏Å‡∏¥‡∏à'];
        const CYCLE_TOP = ['0', '‡∏ä', '‡∏ö', '‡∏î']; 
        const CYCLE_BOTTOM = ['0', '‡∏ä', '‡∏ö', '‡∏î', ...NON_WORKING_CODES];

        const INITIAL_NURSES = [
            { id: 1, name: "‡∏ô‡∏≤‡∏á‡∏™‡∏á‡∏ö ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏ò‡∏£‡∏£‡∏°", pos: "‡∏´‡∏ô‡∏ï." },
            { id: 2, name: "‡∏ô‡∏≤‡∏¢‡∏ß‡∏¥‡∏©‡∏ì‡∏∏‡∏Å‡∏£‡∏ì‡πå ‡πÇ‡∏¢‡∏¢‡∏≤", pos: "L5" },
            { id: 3, name: "‡∏ô.‡∏™.‡∏à‡∏≤‡∏£‡∏∏‡∏û‡∏£ ‡∏®‡∏£‡∏µ‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥", pos: "L5" },
            { id: 4, name: "‡∏ô.‡∏™.‡πÄ‡∏Ç‡∏°‡∏£‡∏∏‡∏à‡∏¥ ‡∏¢‡∏≤‡∏™‡∏π‡πà", pos: "L4" },
            { id: 5, name: "‡∏ô.‡∏™.‡∏õ‡∏≤‡∏à‡∏≤‡∏£‡∏µ‡∏¢‡πå ‡∏ô‡∏¥‡∏û‡∏±‡∏ô‡∏ò‡πå", pos: "L4" },
            { id: 6, name: "‡∏ô.‡∏™.‡∏™‡∏∏‡∏ô‡∏¥‡∏™‡∏≤ ‡∏™‡∏∏‡∏Ç‡πÄ‡∏≠‡∏¥‡∏ö", pos: "L4" },
            { id: 7, name: "‡∏ô.‡∏™.‡∏™‡∏∏‡∏†‡∏≤‡∏ß‡∏î‡∏µ ‡∏¢‡∏°‡∏ô‡πâ‡∏≠‡∏¢", pos: "L2" },
            { id: 8, name: "‡∏ô.‡∏™.‡∏ó‡∏¥‡∏û‡∏õ‡∏†‡∏≤ ‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏ò‡∏µ", pos: "L2" },
            { id: 9, name: "‡∏ô.‡∏™.‡∏™‡∏∏‡∏ô‡∏±‡∏ô‡∏ó‡∏£‡∏≤ ‡πÄ‡∏Å‡∏ï‡∏∏‡∏û‡∏á‡∏©‡πå", pos: "L1" },
            { id: 10, name: "‡∏ô.‡∏™.‡∏™‡∏¥‡∏£‡∏¥‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏ö‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê", pos: "L1" }
        ];

        export default function RosterApp() {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [nurses, setNurses] = useState(INITIAL_NURSES);
            const [schedule, setSchedule] = useState({});
            const [customHolidays, setCustomHolidays] = useState([]);
            const [workDayLimit, setWorkDayLimit] = useState(20);
            const [showModal, setShowModal] = useState(false);
            const [showStatsModal, setShowStatsModal] = useState(false);
            const [newNurse, setNewNurse] = useState({ name: '', pos: 'L1' });
            const [customConditions, setCustomConditions] = useState('');
            const [editingNurse, setEditingNurse] = useState(null);
            const [isGenerating, setIsGenerating] = useState(false);

            // Load Data
            useEffect(() => {
                const savedData = localStorage.getItem('roster_data_v31');
                const savedNurses = localStorage.getItem('roster_nurses_v31');
                const savedHolidays = localStorage.getItem('roster_holidays_v31');
                const savedLimit = localStorage.getItem('roster_limit_v31');
                const savedConditions = localStorage.getItem('roster_conditions_v31');
                
                if (savedData) setSchedule(JSON.parse(savedData));
                if (savedNurses) setNurses(JSON.parse(savedNurses));
                if (savedHolidays) setCustomHolidays(JSON.parse(savedHolidays));
                if (savedLimit) setWorkDayLimit(Number(savedLimit));
                if (savedConditions) setCustomConditions(savedConditions);
            }, []);

            const saveAll = (updatedNurses, updatedSchedule, updatedHolidays, updatedLimit, updatedConditions) => {
                if(updatedNurses) {
                    setNurses(updatedNurses);
                    localStorage.setItem('roster_nurses_v31', JSON.stringify(updatedNurses));
                }
                if(updatedSchedule) {
                    setSchedule(updatedSchedule);
                    localStorage.setItem('roster_data_v31', JSON.stringify(updatedSchedule));
                }
                if(updatedHolidays) {
                    setCustomHolidays(updatedHolidays);
                    localStorage.setItem('roster_holidays_v31', JSON.stringify(updatedHolidays));
                }
                if(updatedLimit !== undefined) {
                    setWorkDayLimit(updatedLimit);
                    localStorage.setItem('roster_limit_v31', updatedLimit);
                }
                if(updatedConditions !== undefined) {
                    setCustomConditions(updatedConditions);
                    localStorage.setItem('roster_conditions_v31', updatedConditions);
                }
            };

            const getDaysInMonth = () => new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
            const getKey = (id, row, day) => `${id}-${row}-${day}`;
            const isHN = (n) => n.pos && n.pos.includes('‡∏´‡∏ô‡∏ï');
            const isHoliday = (day) => {
                const d = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                return [0, 6].includes(d.getDay()) || customHolidays.includes(day);
            };

            const canDoNight = (n) => ['‡∏´‡∏ô‡∏ï.', 'L5', 'L4'].includes(n.pos);
            const canDoDouble = (n) => !['L1'].includes(n.pos);

            const clearAllData = () => {
                if(confirm("‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?\n\n(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£)")) {
                    setSchedule({});
                    saveAll(null, {}, null, workDayLimit, customConditions);
                }
            };

            // AUTO GENERATE LOGIC v31
            const autoGenerateRoster = async () => {
                if (!confirm(`üéØ ‡∏à‡∏±‡∏î‡πÄ‡∏ß‡∏£‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (v31: Ultra Balanced)\n\n‚úÖ ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÄ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏°‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô\n‚úÖ ‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÄ‡∏ß‡∏£‡πÄ‡∏ä‡πâ‡∏≤/‡∏ö‡πà‡∏≤‡∏¢/‡∏î‡∏∂‡∏Å\n‚úÖ ‡∏™‡∏°‡∏î‡∏∏‡∏• OT ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏µ‡∏°\n‚úÖ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ${workDayLimit} ‡∏ß‡∏±‡∏ô/‡∏Ñ‡∏ô\n‚úÖ ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏ß‡∏£‡∏î‡∏∂‡∏Å‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô\n\n‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠?`)) return;

                setIsGenerating(true);
                await new Promise(resolve => setTimeout(resolve, 100));

                const days = getDaysInMonth();
                let newSchedule = { ...schedule };
                
                let workDayCounts = {};
                let morningCounts = {};
                let afternoonCounts = {};
                let nightCounts = {};
                let otCounts = {};
                
                nurses.forEach(n => {
                    workDayCounts[n.id] = 0;
                    morningCounts[n.id] = 0;
                    afternoonCounts[n.id] = 0;
                    nightCounts[n.id] = 0;
                    otCounts[n.id] = 0;
                });

                // Reset Auto Data
                nurses.forEach(n => {
                    for(let d=1; d<=days; d++) {
                        if(['‡∏ä','‡∏ö','‡∏î'].includes(newSchedule[getKey(n.id, 0, d)])) newSchedule[getKey(n.id, 0, d)] = '0';
                        if(['‡∏ä','‡∏ö','‡∏î'].includes(newSchedule[getKey(n.id, 1, d)])) newSchedule[getKey(n.id, 1, d)] = '0';
                    }
                });

                const createBalancedQueue = (candidates, countObj, secondaryCountObj = null) => {
                    return candidates.sort((a, b) => {
                        const diff = countObj[a.id] - countObj[b.id];
                        if (diff !== 0) return diff;
                        if (secondaryCountObj) return secondaryCountObj[a.id] - secondaryCountObj[b.id];
                        return 0;
                    });
                };

                for (let d = 1; d <= days; d++) {
                    const isRedDay = isHoliday(d);
                    let usedToday = [];
                    
                    let unavailableIds = [];
                    let nightYesterdayIds = [];
                    nurses.forEach(n => {
                        const v1 = newSchedule[getKey(n.id, 1, d)];
                        if (NON_WORKING_CODES.includes(v1)) unavailableIds.push(n.id);
                        if (d > 1 && newSchedule[getKey(n.id, 1, d-1)] === '‡∏î') nightYesterdayIds.push(n.id);
                    });

                    const hn = nurses.find(isHN);
                    if(hn && !unavailableIds.includes(hn.id) && !nightYesterdayIds.includes(hn.id)) {
                        newSchedule[getKey(hn.id, 1, d)] = isRedDay ? '0' : '‡∏ä';
                        if(!isRedDay) {
                            workDayCounts[hn.id]++;
                            morningCounts[hn.id]++;
                            usedToday.push(hn.id);
                        }
                    }

                    // NIGHT SHIFT
                    let nightCandidates = nurses.filter(n => 
                        !usedToday.includes(n.id) && 
                        !unavailableIds.includes(n.id) &&
                        !nightYesterdayIds.includes(n.id) &&
                        canDoNight(n)
                    );
                    
                    nightCandidates = createBalancedQueue(nightCandidates, nightCounts, workDayCounts);
                    
                    for(let i=0; i<2 && i<nightCandidates.length; i++) {
                        const n = nightCandidates[i];
                        newSchedule[getKey(n.id, 1, d)] = '‡∏î';
                        workDayCounts[n.id]++;
                        nightCounts[n.id]++;
                        usedToday.push(n.id);
                    }

                    // MORNING SHIFT
                    let currentMorning = nurses.filter(n => newSchedule[getKey(n.id, 1, d)] === '‡∏ä').length;
                    let neededMorning = 5 - currentMorning;
                    
                    let morningCandidates = nurses.filter(n => 
                        !usedToday.includes(n.id) && 
                        !unavailableIds.includes(n.id) &&
                        !nightYesterdayIds.includes(n.id)
                    );
                    
                    morningCandidates = createBalancedQueue(morningCandidates, morningCounts, workDayCounts);

                    for(let i=0; i<neededMorning && i<morningCandidates.length; i++) {
                        const n = morningCandidates[i];
                        newSchedule[getKey(n.id, 1, d)] = '‡∏ä';
                        workDayCounts[n.id]++;
                        morningCounts[n.id]++;
                        usedToday.push(n.id);
                    }

                    // AFTERNOON SHIFT
                    let assignedAfternoon = 0;
                    
                    let afternoonCandidates = nurses.filter(n => 
                        !usedToday.includes(n.id) &&
                        !unavailableIds.includes(n.id) &&
                        canDoDouble(n)
                    );
                    
                    afternoonCandidates = createBalancedQueue(afternoonCandidates, afternoonCounts, workDayCounts);

                    for(let n of afternoonCandidates) {
                        if(assignedAfternoon >= 2) break;
                        
                        newSchedule[getKey(n.id, 1, d)] = '‡∏ö';
                        workDayCounts[n.id]++;
                        afternoonCounts[n.id]++;
                        usedToday.push(n.id);
                        assignedAfternoon++;
                    }

                    if(assignedAfternoon < 3) {
                        let morningTeam = nurses.filter(n => newSchedule[getKey(n.id, 1, d)] === '‡∏ä');
                        let doubleCandidates = morningTeam.filter(n => canDoDouble(n) && !isHN(n));
                        
                        doubleCandidates = createBalancedQueue(doubleCandidates, otCounts, afternoonCounts);
                        
                        for(let n of doubleCandidates) {
                            if(assignedAfternoon >= 3) break;
                            newSchedule[getKey(n.id, 0, d)] = '‡∏ö';
                            otCounts[n.id]++;
                            afternoonCounts[n.id]++;
                            assignedAfternoon++;
                        }
                    }

                    if(assignedAfternoon < 3) {
                        afternoonCandidates = afternoonCandidates.filter(n => !usedToday.includes(n.id));
                        
                        for(let n of afternoonCandidates) {
                            if(assignedAfternoon >= 3) break;
                            newSchedule[getKey(n.id, 1, d)] = '‡∏ö';
                            workDayCounts[n.id]++;
                            afternoonCounts[n.id]++;
                            usedToday.push(n.id);
                            assignedAfternoon++;
                        }
                    }
                }

                // POST-PROCESS: BALANCE TO TARGET
                nurses.forEach(n => {
                    let totalRow1 = 0;
                    for(let d=1; d<=days; d++) {
                         if(['‡∏ä','‡∏ö','‡∏î'].includes(newSchedule[getKey(n.id, 1, d)])) totalRow1++;
                    }

                    let excess = totalRow1 - workDayLimit;
                    
                    if (excess > 0) {
                        for(let d=1; d<=days && excess > 0; d++) {
                            const kBot = getKey(n.id, 1, d);
                            const kTop = getKey(n.id, 0, d);
                            
                            if(newSchedule[kBot] === '‡∏ä' && newSchedule[kTop] === '0') {
                                newSchedule[kBot] = '0';
                                newSchedule[kTop] = '‡∏ä';
                                excess--;
                            }
                        }
                    }
                    
                    let deficit = workDayLimit - totalRow1;
                    if (deficit > 0) {
                        for(let d=1; d<=days && deficit > 0; d++) {
                            const kBot = getKey(n.id, 1, d);
                            const v1 = newSchedule[kBot];
                            
                            if(v1 === '0' && !NON_WORKING_CODES.includes(v1)) {
                                const nightYesterday = d > 1 && newSchedule[getKey(n.id, 1, d-1)] === '‡∏î';
                                if(!nightYesterday) {
                                    const morningCount = countDaily(d, '‡∏ä', newSchedule);
                                    if(morningCount < 5) {
                                        newSchedule[kBot] = '‡∏ä';
                                        deficit--;
                                    }
                                }
                            }
                        }
                    }
                });

                setSchedule(newSchedule);
                saveAll(null, newSchedule, null, workDayLimit, customConditions);
                setIsGenerating(false);
                
                let summary = `‚úÖ ‡∏à‡∏±‡∏î‡πÄ‡∏ß‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (v31)\n\nüìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£:\n`;
                nurses.forEach(n => {
                    let total = 0;
                    for(let d=1; d<=days; d++) {
                        if(['‡∏ä','‡∏ö','‡∏î'].includes(newSchedule[getKey(n.id, 1, d)])) total++;
                    }
                    const status = total === workDayLimit ? '‚úì' : (total < workDayLimit ? '‚ö†' : '‚Üë');
                    summary += `${status} ${n.name.split(' ')[0]}: ${total} ‡∏ß‡∏±‡∏ô\n`;
                });
                
                alert(summary);
            };

            const countStats = (nurseId) => {
                const days = getDaysInMonth();
                let otCount = 0;
                let normalCount = 0;
                let workDays = 0;
                let morningCount = 0;
                let afternoonCount = 0;
                let nightCount = 0;

                for(let d=1; d<=days; d++) {
                    const val1 = schedule[getKey(nurseId, 0, d)] || '0';
                    const val2 = schedule[getKey(nurseId, 1, d)] || '0';
                    
                    if (['‡∏ä','‡∏ö','‡∏î'].includes(val1)) otCount++;
                    if (['‡∏ä','‡∏ö','‡∏î'].includes(val2)) normalCount++;

                    if(val2 === '‡∏ä' || val1 === '‡∏ä') morningCount++;
                    if(val2 === '‡∏ö' || val1 === '‡∏ö') afternoonCount++;
                    if(val2 === '‡∏î') nightCount++;

                    const isWorking = (val1 !== '0' && !NON_WORKING_CODES.includes(val1)) || 
                                      (val2 !== '0' && !NON_WORKING_CODES.includes(val2));
                    if (isWorking) workDays++;
                }

                return {
                    normalCount,
                    normalPay: normalCount * RATES.shift,
                    otCount,
                    otPay: otCount * RATES.ot,
                    workDays,
                    morningCount,
                    afternoonCount,
                    nightCount
                };
            };

            const handleLimitChange = (e) => {
                const val = parseInt(e.target.value) || 0;
                setWorkDayLimit(val);
                saveAll(null, null, null, val, customConditions);
            };

            const toggleHoliday = (day) => {
                const newHolidays = customHolidays.includes(day) 
                    ? customHolidays.filter(d => d !== day) 
                    : [...customHolidays, day];
                setCustomHolidays(newHolidays);
                saveAll(null, null, newHolidays, workDayLimit, customConditions);
            };

            const cycleShift = (id, row, day) => {
                const key = getKey(id, row, day);
                const current = schedule[key] || '0';
                const cycleOrder = (row === 0) ? CYCLE_TOP : CYCLE_BOTTOM;
                const nextIndex = (cycleOrder.indexOf(current) + 1) % cycleOrder.length;
                const newSchedule = { ...schedule, [key]: cycleOrder[nextIndex] };
                saveAll(null, newSchedule, null, workDayLimit, customConditions);
            };

            const handleAddNurse = () => {
                if(!newNurse.name.trim()) {
                    alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•');
                    return;
                }
                const updated = [...nurses, { id: Date.now(), name: newNurse.name, pos: newNurse.pos || 'L1' }];
                saveAll(updated, null, null, workDayLimit, customConditions);
                setNewNurse({ name: '', pos: 'L1' });
                setShowModal(false);
            };

            const handleDeleteNurse = (id) => {
                const nurse = nurses.find(n => n.id === id);
                if(confirm(`üóëÔ∏è ‡∏•‡∏ö "${nurse.name}" ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?\n\n(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏£‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏î‡πâ‡∏ß‡∏¢)`)) {
                    saveAll(nurses.filter(n => n.id !== id), null, null, workDayLimit, customConditions);
                }
            };

            const handleEditNurse = (nurse) => {
                setEditingNurse({ ...nurse });
            };

            const handleSaveEdit = () => {
                if (!editingNurse.name.trim()) {
                    alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•');
                    return;
                }
                const updatedNurses = nurses.map(n => 
                    n.id === editingNurse.id ? { ...editingNurse } : n
                );
                saveAll(updatedNurses, null, null, workDayLimit, customConditions);
                setEditingNurse(null);
            };

            const handleCancelEdit = () => setEditingNurse(null);

            const countDaily = (day, type, scheduleToUse = schedule) => {
                let count = 0;
                nurses.forEach(n => {
                    if(scheduleToUse[getKey(n.id, 0, day)] === type) count++;
                    if(scheduleToUse[getKey(n.id, 1, day)] === type) count++;
                });
                return count;
            };

            const exportExcel = () => {
                const wb = XLSX.utils.book_new();
                const days = Array.from({length: getDaysInMonth()}, (_, i) => i + 1);
                const header = ['No', '‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•', '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á', ...days, '‡∏£‡∏ß‡∏°‡πÄ‡∏ß‡∏£', '‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏£', '‡∏£‡∏ß‡∏° OT', '‡∏Ñ‡πà‡∏≤ OT', '‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£'];
                const data = [];
                
                nurses.forEach((n, idx) => {
                    const s = countStats(n.id);
                    const r1 = [idx + 1, n.name, n.pos];
                    days.forEach(d => r1.push(schedule[getKey(n.id, 0, d)] || '0'));
                    r1.push(s.normalCount, s.normalPay, s.otCount, s.otPay, s.workDays);
                    
                    const r2 = ['', '', ''];
                    days.forEach(d => r2.push(schedule[getKey(n.id, 1, d)] || '0'));
                    r2.push('', '', '', '', '');
                    
                    data.push(r1, r2);
                });
                
                const ws = XLSX.utils.aoa_to_sheet([header, ...data]);
                XLSX.utils.book_append_sheet(wb, ws, "Roster");
                XLSX.writeFile(wb, `‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏£_${currentDate.toLocaleDateString('th-TH', { month: 'long', year: 'numeric' })}.xlsx`);
            };

            const exportCSV = () => {
                let csv = 'No,‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•,‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á,';
                const days = getDaysInMonth();
                for(let i=1; i<=days; i++) csv += `${i},`;
                csv += '‡∏£‡∏ß‡∏°‡πÄ‡∏ß‡∏£,‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏£,‡∏£‡∏ß‡∏° OT,‡∏Ñ‡πà‡∏≤ OT,‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£\n';
                
                nurses.forEach((n, idx) => {
                    const s = countStats(n.id);
                    csv += `${idx+1},${n.name},${n.pos},`;
                    for(let d=1; d<=days; d++) csv += `${schedule[getKey(n.id, 0, d)] || '0'},`;
                    csv += `${s.normalCount},${s.normalPay},${s.otCount},${s.otPay},${s.workDays}\n`;
                    
                    csv += `,,,`;
                    for(let d=1; d<=days; d++) csv += `${schedule[getKey(n.id, 1, d)] || '0'},`;
                    csv += ',,,,,\n';
                });
                
                const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏£_${currentDate.getMonth()+1}.csv`;
                link.click();
            };

            const getOverallStats = () => {
                let totalWork = 0;
                let totalOT = 0;
                let minWork = Infinity;
                let maxWork = 0;
                let avgWork = 0;

                nurses.forEach(n => {
                    const s = countStats(n.id);
                    totalWork += s.normalCount;
                    totalOT += s.otCount;
                    minWork = Math.min(minWork, s.normalCount);
                    maxWork = Math.max(maxWork, s.normalCount);
                });

                avgWork = (totalWork / nurses.length).toFixed(1);

                return { totalWork, totalOT, minWork, maxWork, avgWork };
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col h-screen">
                    {/* Header */}
                    <div className="bg-gradient-to-r from-green-600 to-green-700 text-white p-3 flex justify-between items-center shadow-lg shrink-0 z-50 overflow-x-auto no-print">
                        <div className="flex items-center gap-4 min-w-max">
                            <div>
                                <h1 className="text-xl font-bold flex items-center gap-2">
                                    <Calculator size={22}/> 
                                    ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•
                                    <span className="text-xs bg-yellow-400 text-gray-900 px-2 py-0.5 rounded-full font-bold">v31</span>
                                </h1>
                                <p className="text-green-100 text-sm mt-0.5">
                                    üìÖ {currentDate.toLocaleDateString('th-TH', { month: 'long', year: 'numeric' })} 
                                    <span className="ml-2 text-xs">({nurses.length} ‡∏Ñ‡∏ô)</span>
                                </p>
                            </div>
                            
                            <div className="bg-green-800/50 backdrop-blur-sm p-2 rounded-lg flex items-center gap-2 border border-green-600">
                                <Settings size={16}/>
                                <span className="text-xs font-medium">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</span>
                                <input 
                                    type="number" 
                                    value={workDayLimit} 
                                    onChange={handleLimitChange} 
                                    className="w-14 text-black text-center rounded text-sm px-1 h-7 font-bold focus:ring-2 focus:ring-yellow-400"
                                    min="1"
                                    max="31"
                                />
                                <span className="text-xs text-green-200">‡∏ß‡∏±‡∏ô/‡∏Ñ‡∏ô</span>
                            </div>
                        </div>

                        <div className="flex items-center gap-2 min-w-max ml-4">
                            <div className="flex bg-green-600/50 backdrop-blur-sm rounded-lg p-1 border border-green-500">
                                <button 
                                    onClick={() => setCurrentDate(new Date(currentDate.setMonth(currentDate.getMonth() - 1)))} 
                                    className="p-1.5 hover:bg-green-500 rounded transition-colors"
                                    title="‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤"
                                >
                                    <ChevronLeft size={18}/>
                                </button>
                                <button 
                                    onClick={() => setCurrentDate(new Date())} 
                                    className="px-3 py-1 hover:bg-green-500 rounded text-xs font-medium transition-colors"
                                    title="‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô"
                                >
                                    ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                                </button>
                                <button 
                                    onClick={() => setCurrentDate(new Date(currentDate.setMonth(currentDate.getMonth() + 1)))} 
                                    className="p-1.5 hover:bg-green-500 rounded transition-colors"
                                    title="‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ"
                                >
                                    <ChevronRight size={18}/>
                                </button>
                            </div>

                            <button 
                                onClick={() => setShowStatsModal(true)} 
                                className="bg-blue-500 hover:bg-blue-600 px-3 py-2 rounded-lg flex items-center gap-1.5 text-sm font-medium shadow-md transition-all hover:shadow-lg"
                                title="‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°"
                            >
                                <BarChart3 size={16}/> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                            </button>

                            <button 
                                onClick={autoGenerateRoster} 
                                disabled={isGenerating}
                                className="bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 px-4 py-2 rounded-lg flex items-center gap-1.5 text-sm font-bold shadow-lg text-gray-900 border-2 border-yellow-300 transition-all hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                                title="‡∏à‡∏±‡∏î‡πÄ‡∏ß‡∏£‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥"
                            >
                                {isGenerating ? (
                                    <>
                                        <div className="spinner w-4 h-4 border-2"></div>
                                        <span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î...</span>
                                    </>
                                ) : (
                                    <>
                                        <Zap size={16} className="fill-gray-900"/> 
                                        ‡∏à‡∏±‡∏î‡πÄ‡∏ß‡∏£‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                                    </>
                                )}
                            </button>

                            <button 
                                onClick={clearAllData} 
                                className="bg-red-500 hover:bg-red-600 px-3 py-2 rounded-lg flex items-center gap-1.5 text-sm font-medium shadow-md transition-all hover:shadow-lg"
                                title="‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"
                            >
                                <Eraser size={16}/> ‡∏•‡πâ‡∏≤‡∏á
                            </button>

                            <button 
                                onClick={() => setShowModal(true)} 
                                className="bg-blue-500 hover:bg-blue-600 px-3 py-2 rounded-lg flex items-center gap-1.5 text-sm font-medium shadow-md transition-all hover:shadow-lg"
                                title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÉ‡∏´‡∏°‡πà"
                            >
                                <UserPlus size={16}/> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô
                            </button>

                            <div className="flex gap-1">
                                <button 
                                    onClick={exportExcel} 
                                    className="bg-white text-green-700 hover:bg-gray-50 px-3 py-2 rounded-lg flex items-center gap-1.5 text-sm font-bold shadow-md transition-all hover:shadow-lg"
                                    title="‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel"
                                >
                                    <Download size={16}/> Excel
                                </button>
                                <button 
                                    onClick={exportCSV} 
                                    className="bg-white text-green-700 hover:bg-gray-50 px-3 py-2 rounded-lg flex items-center gap-1.5 text-sm font-bold shadow-md transition-all hover:shadow-lg"
                                    title="‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV"
                                >
                                    <Download size={16}/> CSV
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Custom Conditions */}
                    <div className="bg-gradient-to-r from-green-50 to-blue-50 p-2.5 text-sm border-b-2 border-green-200 shrink-0 no-print">
                        <div className="flex items-center gap-2">
                            <Info size={16} className="text-green-600"/>
                            <span className="font-medium text-gray-700">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</span>
                        </div>
                        <textarea 
                            value={customConditions} 
                            onChange={(e) => saveAll(null, null, null, workDayLimit, e.target.value)} 
                            className="w-full mt-1.5 p-2 text-gray-700 border-2 border-green-200 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent shadow-sm"
                            rows="1"
                            placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏´‡∏ô‡∏ï.‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå, L1 ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£‡∏î‡∏∂‡∏Å, ‡∏°‡∏µ‡∏Ñ‡∏ô‡∏•‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 15-20..."
                        />
                    </div>

                    {/* Legend */}
                    <div className="bg-white p-2 text-xs border-b border-gray-200 shrink-0 no-print">
                        <div className="flex flex-wrap gap-4 items-center justify-center">
                            <span className="font-bold text-gray-700">üé® ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå:</span>
                            <div className="flex gap-3">
                                <span className="px-2 py-1 rounded bg-green-50 text-green-700 font-bold border border-green-200">‡∏ä = ‡πÄ‡∏ä‡πâ‡∏≤</span>
                                <span className="px-2 py-1 rounded bg-yellow-50 text-yellow-700 font-bold border border-yellow-200">‡∏ö = ‡∏ö‡πà‡∏≤‡∏¢</span>
                                <span className="px-2 py-1 rounded bg-purple-50 text-purple-700 font-bold border border-purple-200">‡∏î = ‡∏î‡∏∂‡∏Å</span>
                                <span className="px-2 py-1 rounded bg-blue-50 text-blue-700 font-bold border border-blue-200">Va = ‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô</span>
                                <span className="px-2 py-1 rounded bg-orange-50 text-orange-700 font-bold border border-orange-200">‡∏õ‡∏ä = ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏ä‡∏î‡πÄ‡∏ä‡∏¢</span>
                                <span className="px-2 py-1 rounded bg-red-100 text-red-700 font-bold border border-red-200">‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</span>
                                <span className="px-2 py-1 rounded bg-indigo-100 text-indigo-700 font-bold border border-indigo-200">‡∏•‡∏≤‡∏Å‡∏¥‡∏à</span>
                            </div>
                            <span className="text-gray-500">| ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ß‡∏£ | ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏±‡∏ß‡∏ß‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span>
                        </div>
                    </div>

                    {/* Table Container */}
                    <div className="flex-1 overflow-auto relative bg-white m-3 shadow-xl rounded-lg border-2 border-gray-200">
                        <table className="border-collapse">
                            <thead>
                                <tr className="h-12 bg-gradient-to-r from-gray-50 to-gray-100 text-gray-700 font-semibold text-sm">
                                    <th className="sticky-1">No</th>
                                    <th className="sticky-2">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th className="sticky-3">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                                    {Array.from({ length: getDaysInMonth() }, (_, i) => {
                                        const day = i + 1;
                                        const isRed = isHoliday(day);
                                        const dayName = ['‡∏≠‡∏≤','‡∏à','‡∏≠','‡∏û','‡∏û‡∏§','‡∏®','‡∏™'][new Date(currentDate.getFullYear(), currentDate.getMonth(), day).getDay()];
                                        return (
                                            <th 
                                                key={i} 
                                                onClick={() => toggleHoliday(day)} 
                                                className={`min-w-[38px] header-hover select-none transition-all border-b-2 ${
                                                    isRed 
                                                        ? 'text-red-600 bg-red-50 border-red-300 font-bold' 
                                                        : 'border-gray-200 hover:bg-gray-100'
                                                }`}
                                                title={`‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠${isRed ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' : '‡∏Å‡∏≥‡∏´‡∏ô‡∏î'}‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î`}
                                            >
                                                <div className="font-bold">{day}</div>
                                                <div className="text-[10px] font-normal text-gray-500 mt-0.5">
                                                    {dayName}
                                                </div>
                                            </th>
                                        );
                                    })}
                                    <th className="min-w-[55px] bg-gradient-to-r from-gray-100 to-gray-200 border-l-2 border-gray-400 font-bold">‡∏ß‡∏±‡∏ô<br/>‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</th>
                                    <th className="min-w-[55px] bg-gradient-to-r from-gray-100 to-gray-200">‡∏Ñ‡πà‡∏≤<br/>‡πÄ‡∏ß‡∏£</th>
                                    <th className="min-w-[55px] bg-gradient-to-r from-orange-50 to-orange-100 text-orange-800 border-l-2 border-orange-300 font-bold">‡∏£‡∏ß‡∏°<br/>OT</th>
                                    <th className="min-w-[55px] bg-gradient-to-r from-orange-50 to-orange-100 text-orange-800">‡∏Ñ‡πà‡∏≤<br/>OT</th>
                                </tr>
                            </thead>
                            <tbody>
                                {nurses.map((nurse, idx) => {
                                    const s = countStats(nurse.id);
                                    const isTargetMet = s.normalCount === workDayLimit;
                                    const targetColor = isTargetMet 
                                        ? 'text-green-600 bg-green-50' 
                                        : (s.normalCount < workDayLimit ? 'text-red-500 bg-red-50' : 'text-blue-600 bg-blue-50');

                                    return (
                                        <React.Fragment key={nurse.id}>
                                            {/* OT Row */}
                                            <tr className="group hover:bg-gray-50 transition-colors fade-in">
                                                <td rowSpan={2} className="sticky-1 font-bold text-gray-600 bg-white group-hover:bg-gray-50 transition-colors">
                                                    {idx + 1}
                                                </td>
                                                <td rowSpan={2} className="sticky-2 text-left px-2 relative bg-white group-hover:bg-gray-50 overflow-hidden transition-colors">
                                                    {editingNurse && editingNurse.id === nurse.id ? (
                                                        <div className="flex flex-col gap-1.5 py-1">
                                                            <input 
                                                                type="text" 
                                                                value={editingNurse.name} 
                                                                onChange={(e) => setEditingNurse({...editingNurse, name: e.target.value})}
                                                                className="text-sm border-2 border-blue-300 rounded px-2 py-1 w-full focus:ring-2 focus:ring-blue-500"
                                                                autoFocus
                                                                placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"
                                                            />
                                                            <select 
                                                                value={editingNurse.pos} 
                                                                onChange={(e) => setEditingNurse({...editingNurse, pos: e.target.value})}
                                                                className="text-xs border-2 border-blue-300 rounded px-2 py-1 w-full focus:ring-2 focus:ring-blue-500"
                                                            >
                                                                <option value="‡∏´‡∏ô‡∏ï.">‡∏´‡∏ô‡∏ï. (‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏∂‡∏Å)</option>
                                                                <option value="L5">L5 (‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©)</option>
                                                                <option value="L4">L4 (‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£)</option>
                                                                <option value="L2">L2 (‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£)</option>
                                                                <option value="L1">L1 (‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏á‡∏≤‡∏ô)</option>
                                                            </select>
                                                            <div className="flex gap-1.5 justify-end">
                                                                <button 
                                                                    onClick={handleSaveEdit} 
                                                                    className="text-white bg-green-500 hover:bg-green-600 px-3 py-1 rounded flex items-center gap-1 text-xs font-bold transition-colors"
                                                                >
                                                                    <Save size={12}/> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                                                                </button>
                                                                <button 
                                                                    onClick={handleCancelEdit} 
                                                                    className="text-white bg-red-500 hover:bg-red-600 px-3 py-1 rounded flex items-center gap-1 text-xs font-bold transition-colors"
                                                                >
                                                                    <X size={12}/> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <>
                                                            <div className="font-medium text-gray-800 text-sm truncate pr-14 w-full" title={nurse.name}>
                                                                {nurse.name}
                                                            </div>
                                                            <div className="flex absolute right-1 top-1/2 -translate-y-1/2 gap-0.5">
                                                                <button 
                                                                    onClick={() => handleEditNurse(nurse)} 
                                                                    className="text-gray-300 hover:text-blue-500 transition-colors p-1.5 rounded hover:bg-blue-50"
                                                                    title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"
                                                                >
                                                                    <Edit2 size={14} />
                                                                </button>
                                                                <button 
                                                                    onClick={() => handleDeleteNurse(nurse.id)} 
                                                                    className="text-gray-300 hover:text-red-500 transition-colors p-1.5 rounded hover:bg-red-50"
                                                                    title="‡∏•‡∏ö‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•"
                                                                >
                                                                    <Trash2 size={14} />
                                                                </button>
                                                            </div>
                                                        </>
                                                    )}
                                                </td>
                                                <td rowSpan={2} className="sticky-3 text-xs font-bold text-gray-700 bg-white group-hover:bg-gray-50 transition-colors">
                                                    {editingNurse && editingNurse.id === nurse.id ? '' : (
                                                        <span className="px-2 py-1 rounded bg-gray-100 border border-gray-300">
                                                            {nurse.pos}
                                                        </span>
                                                    )}
                                                </td>
                                                
                                                {/* OT Row Days */}
                                                {Array.from({ length: getDaysInMonth() }, (_, i) => {
                                                    const d = i + 1;
                                                    const val = schedule[getKey(nurse.id, 0, d)] || '0';
                                                    const colorClass = val !== '0' 
                                                        ? 'text-red-600 font-bold bg-red-50 border-red-200' 
                                                        : 'text-gray-300 bg-white';
                                                    return (
                                                        <td 
                                                            key={d} 
                                                            onClick={() => cycleShift(nurse.id, 0, d)} 
                                                            className={`cell-hover border-b-0 ${colorClass} transition-all`}
                                                            title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ß‡∏£ OT"
                                                        >
                                                            {val}
                                                        </td>
                                                    );
                                                })}

                                                <td rowSpan={2} className={`font-bold text-base border-l-2 border-gray-400 ${targetColor} transition-colors`}>
                                                    {s.normalCount}
                                                    {!isTargetMet && (
                                                        <div className="text-[9px] font-normal">
                                                            {s.normalCount < workDayLimit ? `‡∏Ç‡∏≤‡∏î ${workDayLimit - s.normalCount}` : `‡πÄ‡∏Å‡∏¥‡∏ô ${s.normalCount - workDayLimit}`}
                                                        </div>
                                                    )}
                                                </td>
                                                <td rowSpan={2} className="bg-gray-50 text-gray-700 text-xs font-medium">
                                                    {s.normalPay > 0 ? s.normalPay.toLocaleString() : '-'}
                                                </td>
                                                <td rowSpan={2} className="bg-orange-50 font-bold text-orange-800 text-base border-l-2 border-orange-300">
                                                    {s.otCount}
                                                </td>
                                                <td rowSpan={2} className="bg-orange-50 text-orange-800 text-xs font-medium">
                                                    {s.otPay > 0 ? s.otPay.toLocaleString() : '-'}
                                                </td>
                                            </tr>

                                            {/* Normal Row */}
                                            <tr className="group hover:bg-gray-50 border-b-2 border-gray-300 transition-colors">
                                                {Array.from({ length: getDaysInMonth() }, (_, i) => {
                                                    const d = i + 1;
                                                    const val = schedule[getKey(nurse.id, 1, d)] || '0';
                                                    return (
                                                        <td 
                                                            key={d} 
                                                            onClick={() => cycleShift(nurse.id, 1, d)} 
                                                            className={`cell-hover ${SHIFT_TYPES[val]?.color || ''} transition-all`}
                                                            title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ß‡∏£"
                                                        >
                                                            {val}
                                                        </td>
                                                    );
                                                })}
                                            </tr>
                                        </React.Fragment>
                                    );
                                })}
                            </tbody>
                            <tfoot className="bg-gradient-to-r from-gray-100 to-gray-200 font-bold text-gray-700 text-xs">
                                <tr className="border-t-2 border-gray-400">
                                    <td colSpan="3" className="sticky-1 text-right px-2 bg-gradient-to-r from-gray-100 to-gray-200 z-50 h-9 border-r-0"></td>
                                    <td className="sticky-3 bg-gradient-to-r from-gray-100 to-gray-200 text-right px-2 shadow-none border-r-2 border-gray-400 font-bold">
                                        ‡∏£‡∏ß‡∏° ‡πÄ‡∏ä‡πâ‡∏≤
                                    </td>
                                    {Array.from({ length: getDaysInMonth() }, (_, i) => {
                                        const count = countDaily(i+1, '‡∏ä');
                                        return (
                                            <td key={i} className={`text-green-600 font-bold ${count < 5 ? 'bg-red-100' : 'bg-green-50'}`}>
                                                {count || '-'}
                                            </td>
                                        );
                                    })}
                                    <td colSpan="4" className="bg-gray-300"></td>
                                </tr>
                                <tr>
                                    <td colSpan="3" className="sticky-1 bg-gradient-to-r from-gray-100 to-gray-200 border-r-0"></td>
                                    <td className="sticky-3 bg-gradient-to-r from-gray-100 to-gray-200 text-right px-2 shadow-none border-r-2 border-gray-400 font-bold">
                                        ‡∏£‡∏ß‡∏° ‡∏ö‡πà‡∏≤‡∏¢
                                    </td>
                                    {Array.from({ length: getDaysInMonth() }, (_, i) => {
                                        const count = countDaily(i+1, '‡∏ö');
                                        return (
                                            <td key={i} className={`text-yellow-600 font-bold ${count < 3 ? 'bg-red-100' : 'bg-yellow-50'}`}>
                                                {count || '-'}
                                            </td>
                                        );
                                    })}
                                    <td colSpan="4" className="bg-gray-300"></td>
                                </tr>
                                <tr>
                                    <td colSpan="3" className="sticky-1 bg-gradient-to-r from-gray-100 to-gray-200 border-r-0"></td>
                                    <td className="sticky-3 bg-gradient-to-r from-gray-100 to-gray-200 text-right px-2 shadow-none border-r-2 border-gray-400 font-bold">
                                        ‡∏£‡∏ß‡∏° ‡∏î‡∏∂‡∏Å
                                    </td>
                                    {Array.from({ length: getDaysInMonth() }, (_, i) => {
                                        const count = countDaily(i+1, '‡∏î');
                                        return (
                                            <td key={i} className={`text-purple-600 font-bold ${count < 2 ? 'bg-red-100' : 'bg-purple-50'}`}>
                                                {count || '-'}
                                            </td>
                                        );
                                    })}
                                    <td colSpan="4" className="bg-gray-300"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    {/* Add Nurse Modal */}
                    {showModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 fade-in">
                            <div className="bg-white p-6 rounded-xl shadow-2xl w-96 border-2 border-green-200 fade-in">
                                <h2 className="text-xl font-bold mb-4 text-green-800 flex items-center gap-2">
                                    <UserPlus size={20}/>
                                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÉ‡∏´‡∏°‡πà
                                </h2>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• *</label>
                                        <input 
                                            type="text" 
                                            value={newNurse.name} 
                                            onChange={(e) => setNewNurse({...newNurse, name: e.target.value})}
                                            className="w-full border-2 border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô.‡∏™.‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡πÉ‡∏à‡∏î‡∏µ"
                                            autoFocus
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á *</label>
                                        <select 
                                            value={newNurse.pos} 
                                            onChange={(e) => setNewNurse({...newNurse, pos: e.target.value})}
                                            className="w-full border-2 border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                        >
                                            <option value="‡∏´‡∏ô‡∏ï.">‡∏´‡∏ô‡∏ï. (‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏∂‡∏Å)</option>
                                            <option value="L5">L5 (‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©)</option>
                                            <option value="L4">L4 (‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£)</option>
                                            <option value="L2">L2 (‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£)</option>
                                            <option value="L1">L1 (‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏á‡∏≤‡∏ô)</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="flex justify-end gap-3 mt-6">
                                    <button 
                                        onClick={() => setShowModal(false)}
                                        className="px-5 py-2.5 text-sm font-medium border-2 border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
                                    >
                                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                    </button>
                                    <button 
                                        onClick={handleAddNurse}
                                        className="px-5 py-2.5 text-sm font-bold bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-md"
                                    >
                                        ‚úì ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Statistics Modal */}
                    {showStatsModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 fade-in">
                            <div className="bg-white p-6 rounded-xl shadow-2xl w-full max-w-4xl border-2 border-blue-200 fade-in max-h-[90vh] overflow-y-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold text-blue-800 flex items-center gap-2">
                                        <BarChart3 size={22}/>
                                        üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                                    </h2>
                                    <button 
                                        onClick={() => setShowStatsModal(false)}
                                        className="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100"
                                    >
                                        <X size={20}/>
                                    </button>
                                </div>

                                {/* Overall Stats */}
                                <div className="grid grid-cols-5 gap-4 mb-6">
                                    {(() => {
                                        const stats = getOverallStats();
                                        return (
                                            <>
                                                <div className="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg border-2 border-green-200">
                                                    <div className="text-xs text-green-600 font-medium mb-1">‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</div>
                                                    <div className="text-2xl font-bold text-green-700">{stats.totalWork}</div>
                                                </div>
                                                <div className="bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-lg border-2 border-orange-200">
                                                    <div className="text-xs text-orange-600 font-medium mb-1">‡∏£‡∏ß‡∏° OT</div>
                                                    <div className="text-2xl font-bold text-orange-700">{stats.totalOT}</div>
                                                </div>
                                                <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg border-2 border-blue-200">
                                                    <div className="text-xs text-blue-600 font-medium mb-1">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏Ñ‡∏ô</div>
                                                    <div className="text-2xl font-bold text-blue-700">{stats.avgWork}</div>
                                                </div>
                                                <div className="bg-gradient-to-br from-red-50 to-red-100 p-4 rounded-lg border-2 border-red-200">
                                                    <div className="text-xs text-red-600 font-medium mb-1">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥</div>
                                                    <div className="text-2xl font-bold text-red-700">{stats.minWork}</div>
                                                </div>
                                                <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg border-2 border-purple-200">
                                                    <div className="text-xs text-purple-600 font-medium mb-1">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div>
                                                    <div className="text-2xl font-bold text-purple-700">{stats.maxWork}</div>
                                                </div>
                                            </>
                                        );
                                    })()}
                                </div>

                                {/* Individual Stats */}
                                <div className="bg-gray-50 rounded-lg p-4 border-2 border-gray-200">
                                    <h3 className="font-bold text-gray-700 mb-3 flex items-center gap-2">
                                        <Info size={16}/>
                                        ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô
                                    </h3>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm">
                                            <thead className="bg-gray-200">
                                                <tr>
                                                    <th className="px-3 py-2 text-left border">‡∏ä‡∏∑‡πà‡∏≠</th>
                                                    <th className="px-3 py-2 text-center border">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                                                    <th className="px-3 py-2 text-center border bg-green-100">‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</th>
                                                    <th className="px-3 py-2 text-center border bg-green-100">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏£</th>
                                                    <th className="px-3 py-2 text-center border bg-orange-100">OT</th>
                                                    <th className="px-3 py-2 text-center border bg-orange-100">‡∏Ñ‡πà‡∏≤ OT</th>
                                                    <th className="px-3 py-2 text-center border bg-blue-100">‡πÄ‡∏ä‡πâ‡∏≤</th>
                                                    <th className="px-3 py-2 text-center border bg-yellow-100">‡∏ö‡πà‡∏≤‡∏¢</th>
                                                    <th className="px-3 py-2 text-center border bg-purple-100">‡∏î‡∏∂‡∏Å</th>
                                                    <th className="px-3 py-2 text-center border bg-gray-100">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {nurses.map((n, idx) => {
                                                    const s = countStats(n.id);
                                                    const isBalanced = s.normalCount === workDayLimit;
                                                    return (
                                                        <tr key={n.id} className={`${idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-blue-50`}>
                                                            <td className="px-3 py-2 border font-medium">{n.name}</td>
                                                            <td className="px-3 py-2 border text-center">
                                                                <span className="px-2 py-0.5 bg-gray-200 rounded text-xs font-bold">{n.pos}</span>
                                                            </td>
                                                            <td className={`px-3 py-2 border text-center font-bold ${
                                                                isBalanced ? 'text-green-600 bg-green-50' : 
                                                                (s.normalCount < workDayLimit ? 'text-red-600 bg-red-50' : 'text-blue-600 bg-blue-50')
                                                            }`}>
                                                                {s.normalCount}
                                                                {!isBalanced && <span className="text-[10px] ml-1">({s.normalCount - workDayLimit > 0 ? '+' : ''}{s.normalCount - workDayLimit})</span>}
                                                            </td>
                                                            <td className="px-3 py-2 border text-center bg-green-50">{s.normalPay.toLocaleString()}</td>
                                                            <td className="px-3 py-2 border text-center font-bold text-orange-600 bg-orange-50">{s.otCount}</td>
                                                            <td className="px-3 py-2 border text-center bg-orange-50">{s.otPay.toLocaleString()}</td>
                                                            <td className="px-3 py-2 border text-center bg-blue-50">{s.morningCount}</td>
                                                            <td className="px-3 py-2 border text-center bg-yellow-50">{s.afternoonCount}</td>
                                                            <td className="px-3 py-2 border text-center bg-purple-50">{s.nightCount}</td>
                                                            <td className="px-3 py-2 border text-center font-bold bg-gray-100">{s.workDays}</td>
                                                        </tr>
                                                    );
                                                })}
                                            </tbody>
                                            <tfoot className="bg-gray-300 font-bold">
                                                <tr>
                                                    <td colSpan="2" className="px-3 py-2 border text-right">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</td>
                                                    <td className="px-3 py-2 border text-center bg-green-200">
                                                        {nurses.reduce((sum, n) => sum + countStats(n.id).normalCount, 0)}
                                                    </td>
                                                    <td className="px-3 py-2 border text-center bg-green-200">
                                                        {nurses.reduce((sum, n) => sum + countStats(n.id).normalPay, 0).toLocaleString()}
                                                    </td>
                                                    <td className="px-3 py-2 border text-center bg-orange-200">
                                                        {nurses.reduce((sum, n) => sum + countStats(n.id).otCount, 0)}
                                                    </td>
                                                    <td className="px-3 py-2 border text-center bg-orange-200">
                                                        {nurses.reduce((sum, n) => sum + countStats(n.id).otPay, 0).toLocaleString()}
                                                    </td>
                                                    <td className="px-3 py-2 border text-center bg-blue-200">
                                                        {nurses.reduce((sum, n) => sum + countStats(n.id).morningCount, 0)}
                                                    </td>
                                                    <td className="px-3 py-2 border text-center bg-yellow-200">
                                                        {nurses.reduce((sum, n) => sum + countStats(n.id).afternoonCount, 0)}
                                                    </td>
                                                    <td className="px-3 py-2 border text-center bg-purple-200">
                                                        {nurses.reduce((sum, n) => sum + countStats(n.id).nightCount, 0)}
                                                    </td>
                                                    <td className="px-3 py-2 border text-center bg-gray-200">
                                                        {nurses.reduce((sum, n) => sum + countStats(n.id).workDays, 0)}
                                                    </td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>

                                <div className="mt-4 flex justify-end">
                                    <button 
                                        onClick={() => setShowStatsModal(false)}
                                        className="px-6 py-2.5 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition-colors shadow-md"
                                    >
                                        ‡∏õ‡∏¥‡∏î
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Footer Info */}
                    <div className="bg-gradient-to-r from-gray-100 to-gray-200 p-2 text-center text-xs text-gray-600 border-t border-gray-300 no-print">
                        <div className="flex justify-center items-center gap-4 flex-wrap">
                            <span>üí° ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• v31 - Ultra Balanced Edition</span>
                            <span>|</span>
                            <span>üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏à‡∏±‡∏î‡πÄ‡∏ß‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏°‡πÅ‡∏•‡∏∞‡∏¢‡∏∏‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏°</span>
                            <span>|</span>
                            <span>üìÖ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: {currentDate.toLocaleDateString('th-TH', { month: 'long', year: 'numeric' })}</span>
                            <span>|</span>
                            <span>üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: {nurses.length} ‡∏Ñ‡∏ô</span>
                        </div>
                    </div>

                    {/* Loading Overlay */}
                    {isGenerating && (
                        <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100] fade-in">
                            <div className="bg-white p-8 rounded-2xl shadow-2xl text-center">
                                <div className="spinner mx-auto mb-4"></div>
                                <h3 className="text-lg font-bold text-gray-800 mb-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏ß‡∏£‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...</h3>
                                <p className="text-sm text-gray-600">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
                                <div className="mt-4 flex gap-2 justify-center">
                                    <div className="w-2 h-2 bg-green-500 rounded-full animate-bounce"></div>
                                    <div className="w-2 h-2 bg-green-500 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                                    <div className="w-2 h-2 bg-green-500 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<RosterApp />);
    </script>
</body>
</html>
